FROM golang:alpine AS builder

MAINTAINER 0xO1

RUN apk --update add ca-certificates git

ADD https://github.com/golang/dep/releases/download/v0.4.1/dep-linux-amd64 /usr/bin/dep
RUN chmod +x /usr/bin/dep

WORKDIR /go/src/github.com/0x0I/gcp-gce-exporter

COPY Gopkg.toml Gopkg.lock ./
RUN dep ensure --vendor-only

ADD src/ /go/src/github.com/0x0I/gcp-gce-exporter/

RUN GOPATH=/go go get && GOPATH=/go go build -o /bin/gcp-gce-exporter

FROM alpine:latest

COPY --from=builder /bin/gcp-gce-exporter /usr/bin/gcp-gce-exporter

ENTRYPOINT [ "gcp-gce-exporter" ]
